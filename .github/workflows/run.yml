name: Run CETOmega simulation

on:
push:
branches: [ "main" ]
workflow_dispatch:

jobs:
build:
runs-on: ubuntu-latest
steps:
- name: Checkout
uses: actions/checkout@v4

- name: Set up Python
uses: actions/setup-python@v5
with:
python-version: "3.11"

- name: Install dependencies
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt

- name: Debug repo tree
run: |
pwd
ls -la
echo "---- recursive ----"
ls -R || true

- name: Run simulation
env:
MPLBACKEND: Agg
PYTHONPATH: ${{ github.workspace }}
run: |
python - << 'PY'
import sys, os
print("Python:", sys.version)
import numpy, pandas, matplotlib
print("numpy:", numpy.__version__)
print("pandas:", pandas.__version__)
print("matplotlib:", matplotlib.__version__)
# ejecutar el script
import subprocess, shlex
cmd = shlex.split("python simulate_double_slit.py")
print("Running:", " ".join(cmd))
r = subprocess.run(cmd, check=True)
print("Return code:", r.returncode)
PY
echo "---- outputs ----"
ls -R data figs || true

- name: Upload artifacts
uses: actions/upload-artifact@v4
with:
name: outputs
path: |
data/results.csv
figs/pattern.png
if-no-files-found: warn
